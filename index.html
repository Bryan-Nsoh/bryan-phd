<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Life Dashboard</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --bg: #0a0a0a;
      --card: #1a1a1a;
      --border: #333;
      --text: #fff;
      --muted: #888;
      --accent: #38bdf8;
      --green: #22c55e;
      --yellow: #eab308;
      --red: #ef4444;
      --purple: #a855f7;
      --orange: #f97316;
      --pink: #ec4899;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding: 1rem;
    }
    .container { max-width: 900px; margin: 0 auto; }

    /* Header */
    header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; padding: 0 0.5rem; }
    header h1 { font-size: 1.1rem; color: var(--accent); }
    .header-stat { text-align: right; }
    .header-stat-value { font-size: 1.25rem; font-weight: 700; color: var(--accent); }
    .header-stat-label { font-size: 0.65rem; color: var(--muted); text-transform: uppercase; }

    /* Tabs */
    .tabs { display: flex; gap: 0.5rem; margin-bottom: 1.5rem; border-bottom: 1px solid var(--border); padding-bottom: 0.5rem; overflow-x: auto; }
    .tab { background: none; border: none; color: var(--muted); padding: 0.75rem 1.25rem; cursor: pointer; font-size: 0.9rem; border-radius: 8px 8px 0 0; transition: all 0.2s; white-space: nowrap; }
    .tab:hover { color: var(--text); background: var(--card); }
    .tab.active { color: var(--accent); background: var(--card); font-weight: 600; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }

    /* Cards */
    .card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 1rem; margin-bottom: 1rem; }
    .card h2 { font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--muted); margin-bottom: 0.75rem; }

    /* Progress bars */
    .progress-bar { height: 8px; background: var(--border); border-radius: 4px; overflow: hidden; }
    .progress-fill { height: 100%; background: linear-gradient(90deg, var(--accent), var(--green)); transition: width 0.5s; }

    /* Grid */
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1rem; margin-bottom: 1rem; }
    .grid-3 { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 0.75rem; }

    /* Stats */
    .stat-row { display: flex; justify-content: space-between; padding: 0.4rem 0; border-bottom: 1px solid var(--border); font-size: 0.85rem; }
    .stat-row:last-child { border-bottom: none; }
    .stat-row span:last-child { font-weight: 600; color: var(--green); }

    /* Course Categories */
    .category { background: var(--card); border: 1px solid var(--border); border-radius: 8px; margin-bottom: 0.75rem; overflow: hidden; }
    .category-header { background: #222; padding: 0.6rem 1rem; display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
    .category-header:hover { background: #2a2a2a; }
    .category-title { font-weight: 600; font-size: 0.85rem; display: flex; align-items: center; gap: 0.5rem; }
    .category-title .arrow { transition: transform 0.2s; font-size: 0.7rem; }
    .category.collapsed .arrow { transform: rotate(-90deg); }
    .category.collapsed .category-content { display: none; }
    .category-credits { font-size: 0.75rem; color: var(--muted); }
    .category-content { padding: 0.5rem; }

    /* Items */
    .item-row { display: flex; align-items: center; padding: 0.5rem; margin-bottom: 0.25rem; border-radius: 6px; background: var(--bg); border: 1px solid var(--border); gap: 0.75rem; font-size: 0.85rem; }
    .item-row.completed { opacity: 0.5; }
    .item-row.completed .item-title { text-decoration: line-through; }
    .item-title { flex: 1; }
    .item-meta { display: flex; align-items: center; gap: 0.5rem; }
    .badge { font-size: 0.65rem; padding: 0.15rem 0.4rem; border-radius: 4px; font-weight: 500; }
    .badge.in-progress { background: #3a3a00; color: var(--yellow); }
    .badge.transfer { background: #2a0a3a; color: var(--purple); }
    .badge.planned { background: #1a2a3a; color: var(--accent); }
    .badge.active { background: #0a2a1a; color: var(--green); }
    .badge.paused { background: #2a2a2a; color: var(--muted); }

    /* Deadlines & Milestones */
    .deadline-item { display: flex; align-items: center; padding: 0.5rem 0; border-bottom: 1px solid var(--border); gap: 0.75rem; }
    .deadline-item:last-child { border-bottom: none; }
    .urgency { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
    .urgency.red { background: var(--red); box-shadow: 0 0 6px var(--red); }
    .urgency.yellow { background: var(--yellow); }
    .urgency.green { background: var(--green); }
    .deadline-info { flex: 1; }
    .deadline-name { font-weight: 500; font-size: 0.85rem; }
    .deadline-date { font-size: 0.7rem; color: var(--muted); }
    .deadline-remaining { font-size: 0.8rem; font-weight: 600; }

    .milestone-item { display: flex; align-items: center; padding: 0.5rem 0; border-bottom: 1px solid var(--border); gap: 0.75rem; }
    .milestone-item:last-child { border-bottom: none; }
    .milestone-check { width: 18px; height: 18px; border: 2px solid var(--border); border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; }
    .milestone-check.done { background: var(--green); border-color: var(--green); color: var(--bg); }

    /* Calendar */
    .calendar-nav { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem; }
    .calendar-nav button { background: var(--card); border: 1px solid var(--border); color: var(--text); padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; font-size: 0.85rem; }
    .calendar-nav button:hover { border-color: var(--accent); }
    .calendar-nav button.active { background: var(--accent); color: var(--bg); border-color: var(--accent); }
    .calendar-nav h2 { font-size: 1.1rem; }

    /* Year View */
    .year-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.75rem; margin-bottom: 1.5rem; }
    @media (max-width: 600px) { .year-grid { grid-template-columns: repeat(3, 1fr); } }
    .month-card { background: var(--card); border: 1px solid var(--border); border-radius: 8px; padding: 0.75rem; cursor: pointer; transition: all 0.2s; }
    .month-card:hover { border-color: var(--accent); transform: translateY(-2px); }
    .month-card.selected { border-color: var(--accent); background: #1a2a3a; }
    .month-card.current { border-color: var(--green); }
    .month-card-name { font-weight: 600; font-size: 0.85rem; margin-bottom: 0.3rem; }
    .month-card.current .month-card-name { color: var(--green); }
    .month-card-count { font-size: 0.7rem; color: var(--muted); }
    .month-card-count span { display: inline-block; margin-right: 0.4rem; }
    .month-card-count .deadlines { color: var(--red); }
    .month-card-count .events { color: var(--accent); }

    /* Month Detail */
    .month-detail { background: var(--card); border: 1px solid var(--border); border-radius: 8px; padding: 1rem; margin-bottom: 1rem; }
    .month-detail-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 1px solid var(--border); }
    .month-detail-header h3 { font-size: 1rem; color: var(--accent); }
    .month-detail-close { background: none; border: none; color: var(--muted); cursor: pointer; font-size: 1.2rem; }
    .month-detail-close:hover { color: var(--text); }
    .month-event-list { max-height: 400px; overflow-y: auto; }
    .month-event-item { display: flex; align-items: flex-start; gap: 0.75rem; padding: 0.6rem; background: var(--bg); border-radius: 6px; margin-bottom: 0.4rem; border-left: 3px solid var(--accent); }
    .month-event-item.deadline { border-left-color: var(--red); }
    .month-event-item.academic { border-left-color: var(--purple); }
    .month-event-item.meeting { border-left-color: var(--accent); }
    .month-event-item.personal { border-left-color: var(--green); }
    .month-event-item.work { border-left-color: var(--orange); }
    .month-event-item.admin { border-left-color: var(--yellow); }
    .month-event-item.milestone { border-left-color: var(--pink); }
    .month-event-date { min-width: 40px; font-size: 0.75rem; font-weight: 600; color: var(--muted); }
    .month-event-info { flex: 1; }
    .month-event-name { font-size: 0.85rem; font-weight: 500; }
    .month-event-time { font-size: 0.7rem; color: var(--muted); margin-top: 0.1rem; }
    .month-event-badge { font-size: 0.6rem; padding: 0.1rem 0.35rem; border-radius: 3px; background: var(--border); color: var(--muted); margin-left: 0.4rem; }

    /* Month Grid View */
    .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; background: var(--card); border: 1px solid var(--border); border-radius: 8px; padding: 0.5rem; }
    .calendar-day-header { text-align: center; font-size: 0.65rem; color: var(--muted); padding: 0.4rem; text-transform: uppercase; }
    #calendar-days { display: contents; }
    .calendar-day { min-height: 70px; background: var(--bg); border-radius: 6px; padding: 0.25rem; display: flex; flex-direction: column; }
    .calendar-day.other-month { opacity: 0.3; }
    .calendar-day.today { border: 2px solid var(--accent); }
    .calendar-day.has-events { background: #1a1a2a; }
    .day-number { font-size: 0.75rem; font-weight: 600; color: var(--muted); margin-bottom: 0.15rem; }
    .calendar-day.today .day-number { color: var(--accent); }
    .day-events { flex: 1; overflow: hidden; display: flex; flex-direction: column; gap: 1px; }
    .cal-event { font-size: 0.6rem; padding: 0.1rem 0.25rem; border-radius: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .cal-event.deadline { background: var(--red); color: white; }
    .cal-event.academic { background: var(--purple); color: white; }
    .cal-event.meeting { background: var(--accent); color: var(--bg); }
    .cal-event.personal { background: var(--green); color: var(--bg); }
    .cal-event.work { background: var(--orange); color: var(--bg); }
    .cal-event.admin { background: var(--yellow); color: var(--bg); }
    .cal-event.recurring { border-left: 2px solid var(--yellow); }
    .more-events { font-size: 0.55rem; color: var(--muted); text-align: center; }

    /* Agenda */
    .agenda-section { margin-top: 1.5rem; }
    .agenda-day { margin-bottom: 1rem; }
    .agenda-date { font-size: 0.8rem; font-weight: 600; color: var(--accent); margin-bottom: 0.4rem; padding-bottom: 0.2rem; border-bottom: 1px solid var(--border); }
    .agenda-date.today { color: var(--green); }
    .agenda-event { display: flex; align-items: center; gap: 0.75rem; padding: 0.4rem; background: var(--bg); border-radius: 6px; margin-bottom: 0.2rem; border-left: 3px solid var(--accent); font-size: 0.8rem; }
    .agenda-event.deadline { border-left-color: var(--red); }
    .agenda-event.academic { border-left-color: var(--purple); }
    .agenda-event.meeting { border-left-color: var(--accent); }
    .agenda-event.personal { border-left-color: var(--green); }
    .agenda-event.work { border-left-color: var(--orange); }
    .agenda-time { font-size: 0.7rem; color: var(--muted); min-width: 55px; }
    .agenda-title { flex: 1; }
    .agenda-badge { font-size: 0.55rem; padding: 0.1rem 0.35rem; border-radius: 3px; background: var(--border); color: var(--muted); }

    /* Legend */
    .legend { display: flex; gap: 0.75rem; flex-wrap: wrap; margin-top: 1rem; padding-top: 0.75rem; border-top: 1px solid var(--border); }
    .legend-item { display: flex; align-items: center; gap: 0.25rem; font-size: 0.65rem; color: var(--muted); }
    .legend-dot { width: 8px; height: 8px; border-radius: 2px; }

    /* Projects */
    .project-card { background: var(--card); border: 1px solid var(--border); border-radius: 8px; padding: 1rem; margin-bottom: 0.75rem; }
    .project-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.75rem; }
    .project-name { font-weight: 600; font-size: 1rem; }
    .project-goal { font-size: 0.8rem; color: var(--muted); margin-bottom: 0.75rem; }
    .project-progress { margin-bottom: 0.5rem; }
    .project-progress-label { display: flex; justify-content: space-between; font-size: 0.75rem; color: var(--muted); margin-bottom: 0.25rem; }
    .project-deadlines { margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid var(--border); }
    .project-deadlines h4 { font-size: 0.7rem; color: var(--muted); text-transform: uppercase; margin-bottom: 0.5rem; }

    /* Footer */
    footer { text-align: center; padding: 1.5rem; color: var(--muted); font-size: 0.7rem; }

    /* Empty state */
    .empty-state { color: var(--muted); padding: 2rem; text-align: center; font-size: 0.85rem; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>LIFE DASHBOARD</h1>
      <div class="header-stat">
        <div class="header-stat-value" id="next-deadline-days">--</div>
        <div class="header-stat-label">Days to Next</div>
      </div>
    </header>

    <div class="tabs">
      <button class="tab active" onclick="showTab('calendar')">Calendar</button>
      <button class="tab" onclick="showTab('phd')">PhD</button>
      <button class="tab" onclick="showTab('projects')">Projects</button>
    </div>

    <!-- CALENDAR TAB -->
    <div class="tab-content active" id="tab-calendar">
      <div class="calendar-nav">
        <div style="display: flex; gap: 0.5rem;">
          <button id="view-year" class="active" onclick="setCalendarView('year')">Year</button>
          <button id="view-month" onclick="setCalendarView('month')">Month</button>
        </div>
        <h2 id="calendar-title">2025</h2>
        <div style="display: flex; gap: 0.5rem;">
          <button onclick="changeCalendarPeriod(-1)">← Prev</button>
          <button onclick="changeCalendarPeriod(1)">Next →</button>
        </div>
      </div>

      <div id="year-view">
        <div class="year-grid" id="year-grid"></div>
        <div id="month-detail-container"></div>
      </div>

      <div id="month-view" style="display: none;">
        <div class="calendar-grid">
          <div class="calendar-day-header">Sun</div>
          <div class="calendar-day-header">Mon</div>
          <div class="calendar-day-header">Tue</div>
          <div class="calendar-day-header">Wed</div>
          <div class="calendar-day-header">Thu</div>
          <div class="calendar-day-header">Fri</div>
          <div class="calendar-day-header">Sat</div>
          <div id="calendar-days"></div>
        </div>
      </div>

      <div class="legend">
        <div class="legend-item"><div class="legend-dot" style="background: var(--red)"></div>Deadline</div>
        <div class="legend-item"><div class="legend-dot" style="background: var(--purple)"></div>Academic</div>
        <div class="legend-item"><div class="legend-dot" style="background: var(--accent)"></div>Meeting</div>
        <div class="legend-item"><div class="legend-dot" style="background: var(--green)"></div>Personal</div>
        <div class="legend-item"><div class="legend-dot" style="background: var(--orange)"></div>Work</div>
        <div class="legend-item"><div class="legend-dot" style="background: var(--yellow)"></div>Admin</div>
      </div>

      <div class="agenda-section">
        <div class="card">
          <h2>Coming Up (Next 14 Days)</h2>
          <div id="agenda-list"></div>
        </div>
      </div>
    </div>

    <!-- PhD TAB -->
    <div class="tab-content" id="tab-phd">
      <!-- Progress Overview -->
      <div class="card">
        <h2>PhD Progress</h2>
        <div style="margin-bottom: 1rem;">
          <div style="display: flex; justify-content: space-between; font-size: 0.75rem; color: var(--muted); margin-bottom: 0.25rem;">
            <span>Timeline</span>
            <span id="phd-timeline-pct">0%</span>
          </div>
          <div class="progress-bar"><div class="progress-fill" id="phd-timeline-bar" style="width: 0%"></div></div>
          <div style="display: flex; justify-content: space-between; font-size: 0.7rem; color: var(--muted); margin-top: 0.25rem;">
            <span id="phd-start">Fall 2024</span>
            <span id="phd-end">Spring 2028</span>
          </div>
        </div>
        <div class="grid-3">
          <div class="stat-row"><span>Credits</span><span id="phd-credits">0/36</span></div>
          <div class="stat-row"><span>Transferred</span><span id="phd-transferred">0</span></div>
          <div class="stat-row"><span>In Progress</span><span id="phd-inprogress">0</span></div>
        </div>
      </div>

      <!-- Milestones -->
      <div class="card">
        <h2>Milestones</h2>
        <div id="phd-milestones"></div>
      </div>

      <!-- Upcoming PhD Deadlines -->
      <div class="card">
        <h2>PhD Deadlines</h2>
        <div id="phd-deadlines"></div>
      </div>

      <!-- Courses -->
      <div class="card">
        <h2>Courses</h2>
        <div id="phd-courses"></div>
      </div>
    </div>

    <!-- PROJECTS TAB -->
    <div class="tab-content" id="tab-projects">
      <div id="projects-list"></div>
      <div class="empty-state" id="projects-empty" style="display: none;">
        No projects yet. Ask Claude to add one!
      </div>
    </div>

    <footer>
      <p>To edit: just ask Claude</p>
    </footer>
  </div>

  <script>
    const defaultData = {
      settings: {
        startDate: "2024-08-01",
        endDate: "2028-05-15",
        creditsRequired: 36
      },
      courseCategories: [
        { id: "core", name: "Core Requirements", requiredCredits: 21 },
        { id: "domain", name: "ML/Domain", requiredCredits: 9 },
        { id: "breadth", name: "Knowledge Breadth", requiredCredits: 6 },
        { id: "600level", name: "600-Level Requirement", requiredCredits: 6 },
        { id: "seminar", name: "Seminar", requiredCredits: 3 }
      ],
      courses: [],
      deadlines: [],
      milestones: [],
      events: [],
      projects: []
    };

    let data = JSON.parse(localStorage.getItem('bryan-phd-data')) || defaultData;
    if (!data.events) data.events = [];
    if (!data.projects) data.projects = [];

    let currentMonth = new Date().getMonth();
    let currentYear = new Date().getFullYear();
    let calendarView = 'year';
    let selectedMonthDetail = null;

    function showTab(tabId) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
      document.querySelector(`[onclick="showTab('${tabId}')"]`).classList.add('active');
      document.getElementById('tab-' + tabId).classList.add('active');
    }

    function toggleCategory(id) {
      document.getElementById('cat-' + id).classList.toggle('collapsed');
    }

    function render() {
      renderHeader();
      renderCalendar();
      renderPhD();
      renderProjects();
    }

    function renderHeader() {
      const today = new Date();
      const allDeadlines = [...data.deadlines];
      data.projects.forEach(p => {
        if (p.deadlines) {
          p.deadlines.forEach(d => allDeadlines.push(d));
        }
      });
      const upcoming = allDeadlines
        .map(d => ({ ...d, days: Math.ceil((new Date(d.date) - today) / 86400000) }))
        .filter(d => d.days >= 0)
        .sort((a, b) => a.days - b.days);
      document.getElementById('next-deadline-days').textContent = upcoming.length ? upcoming[0].days : '--';
    }

    // PhD Tab
    function renderPhD() {
      const s = data.settings;
      const start = new Date(s.startDate);
      const end = new Date(s.endDate);
      const today = new Date();
      const pct = Math.min(100, Math.max(0, ((today - start) / (end - start)) * 100));

      document.getElementById('phd-timeline-bar').style.width = pct + '%';
      document.getElementById('phd-timeline-pct').textContent = pct.toFixed(0) + '%';
      document.getElementById('phd-start').textContent = start.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
      document.getElementById('phd-end').textContent = end.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });

      const completed = data.courses.filter(c => c.status === 'completed').reduce((s, c) => s + c.credits, 0);
      const transferred = data.courses.filter(c => c.status === 'transfer').reduce((s, c) => s + c.credits, 0);
      const inProgress = data.courses.filter(c => c.status === 'in-progress').reduce((s, c) => s + c.credits, 0);
      const total = completed + transferred;

      document.getElementById('phd-credits').textContent = `${total}/${s.creditsRequired}`;
      document.getElementById('phd-transferred').textContent = transferred;
      document.getElementById('phd-inprogress').textContent = inProgress;

      // Milestones
      document.getElementById('phd-milestones').innerHTML = data.milestones.length
        ? data.milestones.map(m => `
          <div class="milestone-item">
            <div class="milestone-check ${m.completed ? 'done' : ''}">${m.completed ? '✓' : ''}</div>
            <span style="font-size: 0.85rem;">${m.name}</span>
          </div>
        `).join('')
        : '<div class="empty-state">No milestones defined</div>';

      // Deadlines
      const deadlines = data.deadlines
        .map(d => ({ ...d, days: Math.ceil((new Date(d.date) - today) / 86400000) }))
        .filter(d => d.days >= -30)
        .sort((a, b) => a.days - b.days);

      document.getElementById('phd-deadlines').innerHTML = deadlines.length
        ? deadlines.map(d => renderDeadlineItem(d)).join('')
        : '<div class="empty-state">No deadlines</div>';

      // Courses by category
      document.getElementById('phd-courses').innerHTML = data.courseCategories.map(cat => {
        const courses = data.courses.filter(c => c.category === cat.id);
        if (courses.length === 0) return '';
        const completedCr = courses.filter(c => c.status === 'completed' || c.status === 'transfer').reduce((s, c) => s + c.credits, 0);
        const inProgCr = courses.filter(c => c.status === 'in-progress').reduce((s, c) => s + c.credits, 0);

        return `
          <div class="category" id="cat-${cat.id}">
            <div class="category-header" onclick="toggleCategory('${cat.id}')">
              <span class="category-title"><span class="arrow">▼</span> ${cat.name}</span>
              <span class="category-credits">${completedCr}${inProgCr ? '+' + inProgCr : ''}/${cat.requiredCredits} cr</span>
            </div>
            <div class="category-content">
              ${courses.map(c => {
                const isCompleted = c.status === 'completed' || c.status === 'transfer';
                return `
                  <div class="item-row ${isCompleted ? 'completed' : ''}">
                    <span class="item-title">${c.name}</span>
                    <div class="item-meta">
                      ${c.status === 'in-progress' ? '<span class="badge in-progress">IN PROGRESS</span>' : ''}
                      ${c.status === 'transfer' ? '<span class="badge transfer">TRANSFER</span>' : ''}
                      ${c.status === 'planned' && c.semester ? `<span class="badge planned">${c.semester}</span>` : ''}
                      <span style="color: var(--green); font-weight: 600; font-size: 0.8rem;">${c.credits}cr</span>
                    </div>
                  </div>
                `;
              }).join('')}
            </div>
          </div>
        `;
      }).join('') || '<div class="empty-state">No courses added</div>';
    }

    function renderDeadlineItem(d) {
      const urgency = d.days < 0 ? 'red' : d.days <= 14 ? 'red' : d.days <= 30 ? 'yellow' : 'green';
      let remaining = d.days < 0 ? `${Math.abs(d.days)}d ago` : d.days + 'd';
      if (d.days > 365) remaining = (d.days / 365).toFixed(1) + 'yr';
      else if (d.days > 60) remaining = (d.days / 30).toFixed(1) + 'mo';
      const dateStr = new Date(d.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });

      return `
        <div class="deadline-item">
          <div class="urgency ${urgency}"></div>
          <div class="deadline-info">
            <div class="deadline-name">${d.name}</div>
            <div class="deadline-date">${dateStr}</div>
          </div>
          <div class="deadline-remaining" style="color: var(--${urgency})">${remaining}</div>
        </div>
      `;
    }

    // Projects Tab
    function renderProjects() {
      if (!data.projects || data.projects.length === 0) {
        document.getElementById('projects-list').innerHTML = '';
        document.getElementById('projects-empty').style.display = 'block';
        return;
      }

      document.getElementById('projects-empty').style.display = 'none';
      const today = new Date();

      document.getElementById('projects-list').innerHTML = data.projects.map(p => {
        const deadlinesHtml = p.deadlines && p.deadlines.length > 0
          ? `<div class="project-deadlines">
              <h4>Deadlines</h4>
              ${p.deadlines.map(d => {
                const days = Math.ceil((new Date(d.date) - today) / 86400000);
                return renderDeadlineItem({ ...d, days });
              }).join('')}
            </div>`
          : '';

        return `
          <div class="project-card">
            <div class="project-header">
              <div class="project-name">${p.name}</div>
              <span class="badge ${p.status || 'active'}">${p.status || 'active'}</span>
            </div>
            ${p.goal ? `<div class="project-goal">${p.goal}</div>` : ''}
            ${p.progress !== undefined ? `
              <div class="project-progress">
                <div class="project-progress-label">
                  <span>Progress</span>
                  <span>${p.progress}%</span>
                </div>
                <div class="progress-bar"><div class="progress-fill" style="width: ${p.progress}%"></div></div>
              </div>
            ` : ''}
            ${deadlinesHtml}
          </div>
        `;
      }).join('');
    }

    // Calendar
    function setCalendarView(view) {
      calendarView = view;
      document.getElementById('view-year').classList.toggle('active', view === 'year');
      document.getElementById('view-month').classList.toggle('active', view === 'month');
      document.getElementById('year-view').style.display = view === 'year' ? 'block' : 'none';
      document.getElementById('month-view').style.display = view === 'month' ? 'block' : 'none';
      renderCalendar();
    }

    function changeCalendarPeriod(delta) {
      if (calendarView === 'year') {
        currentYear += delta;
      } else {
        currentMonth += delta;
        if (currentMonth > 11) { currentMonth = 0; currentYear++; }
        if (currentMonth < 0) { currentMonth = 11; currentYear--; }
      }
      renderCalendar();
    }

    function getAllEventsForMonth(year, month) {
      const events = [];
      const daysInMonth = new Date(year, month + 1, 0).getDate();
      for (let day = 1; day <= daysInMonth; day++) {
        const dateStr = formatDateStr(year, month, day);
        const dayEvents = getEventsForDate(dateStr);
        dayEvents.forEach(e => events.push({ ...e, date: dateStr, day }));
      }
      return events.sort((a, b) => a.day - b.day || (a.time || '99:99').localeCompare(b.time || '99:99'));
    }

    function renderYearView() {
      const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
      const today = new Date();
      const currentMonthIndex = today.getMonth();
      const currentYearIndex = today.getFullYear();

      document.getElementById('calendar-title').textContent = currentYear;

      let html = '';
      for (let m = 0; m < 12; m++) {
        const events = getAllEventsForMonth(currentYear, m);
        const deadlineCount = events.filter(e => e.category === 'deadline' || e.category === 'milestone').length;
        const otherCount = events.length - deadlineCount;
        const isCurrent = (m === currentMonthIndex && currentYear === currentYearIndex);
        const isSelected = (selectedMonthDetail === m);

        html += `
          <div class="month-card ${isCurrent ? 'current' : ''} ${isSelected ? 'selected' : ''}" onclick="showMonthDetail(${m})">
            <div class="month-card-name">${monthNames[m]}</div>
            <div class="month-card-count">
              ${deadlineCount > 0 ? `<span class="deadlines">${deadlineCount} deadline${deadlineCount > 1 ? 's' : ''}</span>` : ''}
              ${otherCount > 0 ? `<span class="events">${otherCount} event${otherCount > 1 ? 's' : ''}</span>` : ''}
              ${events.length === 0 ? '<span>No events</span>' : ''}
            </div>
          </div>
        `;
      }

      document.getElementById('year-grid').innerHTML = html;
      if (selectedMonthDetail !== null) renderMonthDetail(selectedMonthDetail);
    }

    function showMonthDetail(month) {
      if (selectedMonthDetail === month) {
        selectedMonthDetail = null;
        document.getElementById('month-detail-container').innerHTML = '';
        document.querySelectorAll('.month-card').forEach(c => c.classList.remove('selected'));
      } else {
        selectedMonthDetail = month;
        renderYearView();
      }
    }

    function renderMonthDetail(month) {
      const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
      const events = getAllEventsForMonth(currentYear, month);

      if (events.length === 0) {
        document.getElementById('month-detail-container').innerHTML = `
          <div class="month-detail">
            <div class="month-detail-header">
              <h3>${monthNames[month]} ${currentYear}</h3>
              <button class="month-detail-close" onclick="showMonthDetail(${month})">×</button>
            </div>
            <div class="empty-state">No events this month</div>
          </div>
        `;
        return;
      }

      const eventsHtml = events.map(e => {
        const dateObj = new Date(e.date + 'T12:00:00');
        const dayStr = dateObj.getDate();
        const dayName = dateObj.toLocaleDateString('en-US', { weekday: 'short' });

        return `
          <div class="month-event-item ${e.category}">
            <div class="month-event-date">${dayName}<br>${dayStr}</div>
            <div class="month-event-info">
              <div class="month-event-name">
                ${e.name}
                ${e.recurring ? '<span class="month-event-badge">recurring</span>' : ''}
              </div>
              ${e.time ? `<div class="month-event-time">${formatTime(e.time)}</div>` : ''}
            </div>
          </div>
        `;
      }).join('');

      document.getElementById('month-detail-container').innerHTML = `
        <div class="month-detail">
          <div class="month-detail-header">
            <h3>${monthNames[month]} ${currentYear} — ${events.length} event${events.length > 1 ? 's' : ''}</h3>
            <button class="month-detail-close" onclick="showMonthDetail(${month})">×</button>
          </div>
          <div class="month-event-list">${eventsHtml}</div>
        </div>
      `;
    }

    function getEventsForDate(dateStr) {
      const events = [];
      const targetDate = new Date(dateStr + 'T12:00:00');

      // PhD deadlines
      data.deadlines.forEach(d => {
        if (d.date === dateStr) {
          events.push({ name: d.name, category: d.category || 'deadline', time: null });
        }
      });

      // Project deadlines
      data.projects.forEach(p => {
        if (p.deadlines) {
          p.deadlines.forEach(d => {
            if (d.date === dateStr) {
              events.push({ name: `${p.name}: ${d.name}`, category: 'work', time: null });
            }
          });
        }
      });

      // Events (with recurring)
      data.events.forEach(e => {
        if (e.date === dateStr) {
          events.push({ name: e.name, category: e.category || 'meeting', time: e.time });
        } else if (e.recurring) {
          const eventDate = new Date(e.date + 'T12:00:00');
          if (targetDate >= eventDate) {
            const daysDiff = Math.floor((targetDate - eventDate) / 86400000);
            let matches = false;
            if (e.recurring === 'weekly' && daysDiff % 7 === 0) matches = true;
            if (e.recurring === 'biweekly' && daysDiff % 14 === 0) matches = true;
            if (e.recurring === 'monthly' && targetDate.getDate() === eventDate.getDate()) matches = true;
            if (matches) {
              events.push({ name: e.name, category: e.category || 'meeting', time: e.time, recurring: true });
            }
          }
        }
      });

      return events.sort((a, b) => {
        if (!a.time && !b.time) return 0;
        if (!a.time) return 1;
        if (!b.time) return -1;
        return a.time.localeCompare(b.time);
      });
    }

    function formatTime(time) {
      if (!time) return '';
      const [h, m] = time.split(':');
      const hour = parseInt(h);
      const ampm = hour >= 12 ? 'pm' : 'am';
      const hour12 = hour % 12 || 12;
      return `${hour12}${m !== '00' ? ':' + m : ''}${ampm}`;
    }

    function renderCalendar() {
      if (calendarView === 'year') {
        renderYearView();
        renderAgenda();
        return;
      }

      const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
      document.getElementById('calendar-title').textContent = `${monthNames[currentMonth]} ${currentYear}`;

      const firstDay = new Date(currentYear, currentMonth, 1).getDay();
      const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
      const daysInPrevMonth = new Date(currentYear, currentMonth, 0).getDate();
      const today = new Date().toISOString().split('T')[0];

      let html = '';
      for (let i = firstDay - 1; i >= 0; i--) {
        const day = daysInPrevMonth - i;
        const dateStr = formatDateStr(currentYear, currentMonth - 1, day);
        html += renderCalendarDay(day, dateStr, true, today);
      }
      for (let day = 1; day <= daysInMonth; day++) {
        const dateStr = formatDateStr(currentYear, currentMonth, day);
        html += renderCalendarDay(day, dateStr, false, today);
      }
      const totalCells = Math.ceil((firstDay + daysInMonth) / 7) * 7;
      const remaining = totalCells - (firstDay + daysInMonth);
      for (let day = 1; day <= remaining; day++) {
        const dateStr = formatDateStr(currentYear, currentMonth + 1, day);
        html += renderCalendarDay(day, dateStr, true, today);
      }

      document.getElementById('calendar-days').innerHTML = html;
      renderAgenda();
    }

    function formatDateStr(year, month, day) {
      const d = new Date(year, month, day);
      return d.toISOString().split('T')[0];
    }

    function renderCalendarDay(day, dateStr, isOtherMonth, today) {
      const isToday = dateStr === today;
      const events = getEventsForDate(dateStr);
      const hasEvents = events.length > 0;

      let classes = 'calendar-day';
      if (isOtherMonth) classes += ' other-month';
      if (isToday) classes += ' today';
      if (hasEvents) classes += ' has-events';

      let eventsHtml = '';
      const maxShow = 3;
      events.slice(0, maxShow).forEach(e => {
        const recurClass = e.recurring ? ' recurring' : '';
        const timeStr = e.time ? formatTime(e.time) + ' ' : '';
        eventsHtml += `<div class="cal-event ${e.category}${recurClass}">${timeStr}${e.name}</div>`;
      });
      if (events.length > maxShow) {
        eventsHtml += `<div class="more-events">+${events.length - maxShow} more</div>`;
      }

      return `<div class="${classes}"><span class="day-number">${day}</span><div class="day-events">${eventsHtml}</div></div>`;
    }

    function renderAgenda() {
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      const days = [];

      for (let i = 0; i < 14; i++) {
        const date = new Date(today);
        date.setDate(date.getDate() + i);
        const dateStr = date.toISOString().split('T')[0];
        const events = getEventsForDate(dateStr);
        if (events.length > 0) {
          days.push({ date, dateStr, events, isToday: i === 0 });
        }
      }

      if (days.length === 0) {
        document.getElementById('agenda-list').innerHTML = '<div class="empty-state">No events in the next 14 days</div>';
        return;
      }

      document.getElementById('agenda-list').innerHTML = days.map(d => {
        const dayLabel = d.date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
        return `
          <div class="agenda-day">
            <div class="agenda-date ${d.isToday ? 'today' : ''}">${d.isToday ? 'Today - ' : ''}${dayLabel}</div>
            ${d.events.map(e => `
              <div class="agenda-event ${e.category}">
                <span class="agenda-time">${e.time ? formatTime(e.time) : 'All day'}</span>
                <span class="agenda-title">${e.name}</span>
                ${e.recurring ? '<span class="agenda-badge">recurring</span>' : ''}
              </div>
            `).join('')}
          </div>
        `;
      }).join('');
    }

    render();
  </script>
</body>
</html>
