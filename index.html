<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DSE PhD Tracker</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --bg: #0a0a0a;
      --card: #1a1a1a;
      --border: #333;
      --text: #fff;
      --muted: #888;
      --accent: #38bdf8;
      --green: #22c55e;
      --yellow: #eab308;
      --red: #ef4444;
      --purple: #a855f7;
      --orange: #f97316;
      --pink: #ec4899;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding: 1rem;
    }
    .container { max-width: 900px; margin: 0 auto; }

    /* Tabs */
    .tabs { display: flex; gap: 0.5rem; margin-bottom: 1.5rem; border-bottom: 1px solid var(--border); padding-bottom: 0.5rem; overflow-x: auto; }
    .tab { background: none; border: none; color: var(--muted); padding: 0.75rem 1rem; cursor: pointer; font-size: 0.85rem; border-radius: 8px 8px 0 0; transition: all 0.2s; white-space: nowrap; }
    .tab:hover { color: var(--text); background: var(--card); }
    .tab.active { color: var(--accent); background: var(--card); font-weight: 600; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }

    /* Header */
    header { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 1.5rem; margin-bottom: 1.5rem; }
    header h1 { font-size: 1.25rem; color: var(--accent); margin-bottom: 0.25rem; }
    header p { color: var(--muted); font-size: 0.85rem; }
    .progress-bar { height: 8px; background: var(--border); border-radius: 4px; margin: 1rem 0 0.5rem; overflow: hidden; }
    .progress-fill { height: 100%; background: linear-gradient(90deg, var(--accent), var(--green)); transition: width 0.5s; }
    .quick-stats { display: flex; gap: 1.5rem; margin-top: 1rem; flex-wrap: wrap; }
    .quick-stat-value { font-size: 1.5rem; font-weight: 700; color: var(--accent); }
    .quick-stat-label { font-size: 0.7rem; color: var(--muted); text-transform: uppercase; }

    /* Cards */
    .card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 1rem; margin-bottom: 1rem; }
    .card h2 { font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--muted); margin-bottom: 0.75rem; }

    /* Course Categories */
    .category { background: var(--card); border: 1px solid var(--border); border-radius: 8px; margin-bottom: 1rem; overflow: hidden; }
    .category-header { background: #222; padding: 0.75rem 1rem; display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
    .category-header:hover { background: #2a2a2a; }
    .category-title { font-weight: 600; display: flex; align-items: center; gap: 0.5rem; }
    .category-title .arrow { transition: transform 0.2s; }
    .category.collapsed .arrow { transform: rotate(-90deg); }
    .category.collapsed .category-courses { display: none; }
    .category-credits { font-size: 0.8rem; color: var(--muted); }
    .category-courses { padding: 0.5rem; }

    /* Course Items */
    .course-row { display: flex; align-items: center; padding: 0.6rem 0.5rem; margin-bottom: 0.25rem; border-radius: 6px; background: var(--bg); border: 1px solid var(--border); gap: 0.75rem; }
    .course-row.completed { opacity: 0.5; }
    .course-row.completed .course-title { text-decoration: line-through; }
    .course-title { flex: 1; font-size: 0.9rem; }
    .course-meta { display: flex; align-items: center; gap: 0.5rem; }
    .badge { font-size: 0.7rem; padding: 0.2rem 0.5rem; border-radius: 4px; font-weight: 500; }
    .badge.in-progress { background: #3a3a00; color: var(--yellow); }
    .badge.transfer { background: #2a0a3a; color: var(--purple); }
    .badge.planned { background: #1a2a3a; color: var(--accent); }
    .credits { color: var(--green); font-weight: 600; font-size: 0.85rem; }

    /* Grid */
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1rem; margin-bottom: 1rem; }

    /* Deadlines */
    .deadline-item { display: flex; align-items: center; padding: 0.6rem 0; border-bottom: 1px solid var(--border); gap: 0.75rem; }
    .deadline-item:last-child { border-bottom: none; }
    .urgency { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
    .urgency.red { background: var(--red); box-shadow: 0 0 6px var(--red); }
    .urgency.yellow { background: var(--yellow); }
    .urgency.green { background: var(--green); }
    .deadline-info { flex: 1; }
    .deadline-name { font-weight: 500; font-size: 0.9rem; }
    .deadline-date { font-size: 0.75rem; color: var(--muted); }
    .deadline-remaining { font-size: 0.85rem; font-weight: 600; }

    /* Milestones */
    .milestone-item { display: flex; align-items: center; padding: 0.6rem 0; border-bottom: 1px solid var(--border); gap: 0.75rem; }
    .milestone-item:last-child { border-bottom: none; }
    .milestone-check { width: 20px; height: 20px; border: 2px solid var(--border); border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; }
    .milestone-check.done { background: var(--green); border-color: var(--green); color: var(--bg); }

    /* Summary */
    .summary { background: var(--card); border: 2px solid var(--green); border-radius: 8px; padding: 1rem; margin-top: 1rem; }
    .summary h3 { color: var(--green); font-size: 0.9rem; margin-bottom: 0.75rem; }
    .summary-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 0.5rem; font-size: 0.85rem; }
    .summary-stat { display: flex; justify-content: space-between; padding: 0.25rem 0; }
    .summary-stat span:last-child { font-weight: 600; color: var(--green); }

    /* Calendar */
    .calendar-nav { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem; }
    .calendar-nav button { background: var(--card); border: 1px solid var(--border); color: var(--text); padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; }
    .calendar-nav button:hover { border-color: var(--accent); }
    .calendar-nav button.active { background: var(--accent); color: var(--bg); border-color: var(--accent); }

    /* Year View */
    .year-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.75rem; margin-bottom: 1.5rem; }
    @media (max-width: 600px) { .year-grid { grid-template-columns: repeat(3, 1fr); } }
    .month-card { background: var(--card); border: 1px solid var(--border); border-radius: 8px; padding: 1rem; cursor: pointer; transition: all 0.2s; }
    .month-card:hover { border-color: var(--accent); transform: translateY(-2px); }
    .month-card.selected { border-color: var(--accent); background: #1a2a3a; }
    .month-card.current { border-color: var(--green); }
    .month-card-name { font-weight: 600; font-size: 0.9rem; margin-bottom: 0.5rem; }
    .month-card.current .month-card-name { color: var(--green); }
    .month-card-count { font-size: 0.75rem; color: var(--muted); }
    .month-card-count span { display: inline-block; margin-right: 0.5rem; }
    .month-card-count .deadlines { color: var(--red); }
    .month-card-count .events { color: var(--accent); }

    /* Month Detail */
    .month-detail { background: var(--card); border: 1px solid var(--border); border-radius: 8px; padding: 1rem; margin-bottom: 1rem; }
    .month-detail-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 1px solid var(--border); }
    .month-detail-header h3 { font-size: 1rem; color: var(--accent); }
    .month-detail-close { background: none; border: none; color: var(--muted); cursor: pointer; font-size: 1.2rem; }
    .month-detail-close:hover { color: var(--text); }
    .month-event-list { max-height: 400px; overflow-y: auto; }
    .month-event-item { display: flex; align-items: flex-start; gap: 0.75rem; padding: 0.75rem; background: var(--bg); border-radius: 6px; margin-bottom: 0.5rem; border-left: 3px solid var(--accent); }
    .month-event-item.deadline { border-left-color: var(--red); }
    .month-event-item.academic { border-left-color: var(--purple); }
    .month-event-item.meeting { border-left-color: var(--accent); }
    .month-event-item.personal { border-left-color: var(--green); }
    .month-event-item.work { border-left-color: var(--orange); }
    .month-event-item.admin { border-left-color: var(--yellow); }
    .month-event-item.milestone { border-left-color: var(--pink); }
    .month-event-date { min-width: 45px; font-size: 0.8rem; font-weight: 600; color: var(--muted); }
    .month-event-info { flex: 1; }
    .month-event-name { font-size: 0.9rem; font-weight: 500; }
    .month-event-time { font-size: 0.75rem; color: var(--muted); margin-top: 0.1rem; }
    .month-event-badge { font-size: 0.65rem; padding: 0.15rem 0.4rem; border-radius: 3px; background: var(--border); color: var(--muted); margin-left: 0.5rem; }
    .calendar-nav h2 { font-size: 1.1rem; }
    .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; background: var(--card); border: 1px solid var(--border); border-radius: 8px; padding: 0.5rem; }
    .calendar-day-header { text-align: center; font-size: 0.7rem; color: var(--muted); padding: 0.5rem; text-transform: uppercase; }
    #calendar-days { display: contents; }
    .calendar-day { min-height: 80px; background: var(--bg); border-radius: 6px; padding: 0.3rem; display: flex; flex-direction: column; }
    .calendar-day.other-month { opacity: 0.3; }
    .calendar-day.today { border: 2px solid var(--accent); }
    .calendar-day.has-events { background: #1a1a2a; }
    .day-number { font-size: 0.8rem; font-weight: 600; color: var(--muted); margin-bottom: 0.2rem; }
    .calendar-day.today .day-number { color: var(--accent); }
    .day-events { flex: 1; overflow: hidden; display: flex; flex-direction: column; gap: 1px; }
    .cal-event { font-size: 0.65rem; padding: 0.15rem 0.3rem; border-radius: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .cal-event.deadline { background: var(--red); color: white; }
    .cal-event.academic { background: var(--purple); color: white; }
    .cal-event.meeting { background: var(--accent); color: var(--bg); }
    .cal-event.personal { background: var(--green); color: var(--bg); }
    .cal-event.work { background: var(--orange); color: var(--bg); }
    .cal-event.recurring { border-left: 2px solid var(--yellow); }
    .more-events { font-size: 0.6rem; color: var(--muted); text-align: center; }

    /* Agenda */
    .agenda-section { margin-top: 1.5rem; }
    .agenda-day { margin-bottom: 1rem; }
    .agenda-date { font-size: 0.85rem; font-weight: 600; color: var(--accent); margin-bottom: 0.5rem; padding-bottom: 0.25rem; border-bottom: 1px solid var(--border); }
    .agenda-date.today { color: var(--green); }
    .agenda-event { display: flex; align-items: center; gap: 0.75rem; padding: 0.5rem; background: var(--bg); border-radius: 6px; margin-bottom: 0.25rem; border-left: 3px solid var(--accent); }
    .agenda-event.deadline { border-left-color: var(--red); }
    .agenda-event.academic { border-left-color: var(--purple); }
    .agenda-event.meeting { border-left-color: var(--accent); }
    .agenda-event.personal { border-left-color: var(--green); }
    .agenda-event.work { border-left-color: var(--orange); }
    .agenda-time { font-size: 0.75rem; color: var(--muted); min-width: 60px; }
    .agenda-title { flex: 1; font-size: 0.85rem; }
    .agenda-badge { font-size: 0.6rem; padding: 0.1rem 0.4rem; border-radius: 3px; background: var(--border); color: var(--muted); }

    /* Footer */
    footer { text-align: center; padding: 1.5rem; color: var(--muted); font-size: 0.75rem; }
    footer button { background: none; border: 1px solid var(--border); color: var(--muted); padding: 0.4rem 0.75rem; border-radius: 4px; cursor: pointer; margin: 0 0.2rem; font-size: 0.75rem; }
    footer button:hover { border-color: var(--accent); color: var(--accent); }
    .sync-status { display: inline-flex; align-items: center; gap: 0.4rem; margin-bottom: 0.5rem; }
    .sync-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--muted); }
    .sync-dot.connected { background: var(--green); }
    .sync-dot.syncing { background: var(--yellow); animation: pulse 1s infinite; }
    .sync-dot.error { background: var(--red); }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

    /* Legend */
    .legend { display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 1rem; padding-top: 0.75rem; border-top: 1px solid var(--border); }
    .legend-item { display: flex; align-items: center; gap: 0.3rem; font-size: 0.7rem; color: var(--muted); }
    .legend-dot { width: 10px; height: 10px; border-radius: 2px; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>DSE PhD TRACKER</h1>
      <p id="program-info">Data Science & Engineering • Bredesen Center</p>
      <div class="progress-bar"><div class="progress-fill" id="timeline-bar" style="width: 0%"></div></div>
      <div style="display: flex; justify-content: space-between; font-size: 0.75rem; color: var(--muted);">
        <span>Started: Fall 2025</span>
        <span id="timeline-text">0%</span>
        <span>Target: Spring 2029</span>
      </div>
      <div class="quick-stats">
        <div><div class="quick-stat-value" id="credits-stat">0/36</div><div class="quick-stat-label">Credits</div></div>
        <div><div class="quick-stat-value" id="transferred-stat">6</div><div class="quick-stat-label">Transferred</div></div>
        <div><div class="quick-stat-value" id="in-progress-stat">0</div><div class="quick-stat-label">In Progress</div></div>
        <div><div class="quick-stat-value" id="remaining-stat">0</div><div class="quick-stat-label">Remaining</div></div>
        <div><div class="quick-stat-value" id="next-deadline-stat">--</div><div class="quick-stat-label">Days to Next</div></div>
      </div>
    </header>

    <div class="tabs">
      <button class="tab active" onclick="showTab('overview')">Overview</button>
      <button class="tab" onclick="showTab('calendar')">Calendar</button>
      <button class="tab" onclick="showTab('courses')">Courses</button>
      <button class="tab" onclick="showTab('deadlines')">Deadlines</button>
      <button class="tab" onclick="showTab('milestones')">Milestones</button>
    </div>

    <!-- OVERVIEW TAB -->
    <div class="tab-content active" id="tab-overview">
      <div class="grid">
        <div class="card">
          <h2>Current Semester</h2>
          <div id="current-courses"></div>
        </div>
        <div class="card">
          <h2>Upcoming Deadlines</h2>
          <div id="upcoming-deadlines"></div>
        </div>
      </div>
      <div class="card">
        <h2>Milestones</h2>
        <div id="overview-milestones"></div>
      </div>
      <div class="summary">
        <h3>CREDIT BREAKDOWN</h3>
        <div class="summary-stats">
          <div class="summary-stat"><span>Total Required</span><span>36</span></div>
          <div class="summary-stat"><span>Transferred</span><span id="sum-transferred">6</span></div>
          <div class="summary-stat"><span>Completed</span><span id="sum-completed">0</span></div>
          <div class="summary-stat"><span>In Progress</span><span id="sum-inprogress">0</span></div>
          <div class="summary-stat"><span>Remaining</span><span id="sum-remaining">0</span></div>
        </div>
      </div>
    </div>

    <!-- CALENDAR TAB -->
    <div class="tab-content" id="tab-calendar">
      <div class="calendar-nav">
        <div style="display: flex; gap: 0.5rem;">
          <button id="view-year" class="active" onclick="setCalendarView('year')">Year</button>
          <button id="view-month" onclick="setCalendarView('month')">Month</button>
        </div>
        <h2 id="calendar-title">2025</h2>
        <div style="display: flex; gap: 0.5rem;">
          <button onclick="changeCalendarPeriod(-1)">← Prev</button>
          <button onclick="changeCalendarPeriod(1)">Next →</button>
        </div>
      </div>

      <!-- Year View -->
      <div id="year-view">
        <div class="year-grid" id="year-grid"></div>
        <div id="month-detail-container"></div>
      </div>

      <!-- Month View (hidden by default) -->
      <div id="month-view" style="display: none;">
        <div class="calendar-grid">
          <div class="calendar-day-header">Sun</div>
          <div class="calendar-day-header">Mon</div>
          <div class="calendar-day-header">Tue</div>
          <div class="calendar-day-header">Wed</div>
          <div class="calendar-day-header">Thu</div>
          <div class="calendar-day-header">Fri</div>
          <div class="calendar-day-header">Sat</div>
          <div id="calendar-days"></div>
        </div>
      </div>

      <div class="legend">
        <div class="legend-item"><div class="legend-dot" style="background: var(--red)"></div>Deadline</div>
        <div class="legend-item"><div class="legend-dot" style="background: var(--purple)"></div>Academic</div>
        <div class="legend-item"><div class="legend-dot" style="background: var(--accent)"></div>Meeting</div>
        <div class="legend-item"><div class="legend-dot" style="background: var(--green)"></div>Personal</div>
        <div class="legend-item"><div class="legend-dot" style="background: var(--orange)"></div>Work</div>
        <div class="legend-item"><div class="legend-dot" style="background: var(--yellow)"></div>Admin</div>
        <div class="legend-item"><div class="legend-dot" style="background: var(--pink)"></div>Milestone</div>
      </div>
      <div class="agenda-section">
        <div class="card">
          <h2>Coming Up (Next 14 Days)</h2>
          <div id="agenda-list"></div>
        </div>
      </div>
    </div>

    <!-- COURSES TAB -->
    <div class="tab-content" id="tab-courses">
      <div id="course-categories"></div>
    </div>

    <!-- DEADLINES TAB -->
    <div class="tab-content" id="tab-deadlines">
      <div class="card">
        <h2>All Deadlines</h2>
        <div id="all-deadlines"></div>
      </div>
    </div>

    <!-- MILESTONES TAB -->
    <div class="tab-content" id="tab-milestones">
      <div class="card">
        <h2>All Milestones</h2>
        <div id="all-milestones"></div>
      </div>
    </div>

    <footer>
      <div class="sync-status">
        <div class="sync-dot" id="sync-dot"></div>
        <span id="sync-text">Local only</span>
      </div>
      <p style="margin-bottom: 0.5rem; font-size: 0.7rem;">To edit: just ask Claude</p>
      <button onclick="openModal('github')">GitHub Sync</button>
      <button onclick="exportData()">Export</button>
      <button onclick="document.getElementById('import-file').click()">Import</button>
      <input type="file" id="import-file" accept=".json" style="display:none" onchange="importData(event)">
    </footer>
  </div>

  <!-- GitHub Modal -->
  <div class="modal" id="modal-github" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.8); align-items:center; justify-content:center; z-index:100;">
    <div style="background: var(--card); padding: 1.5rem; border-radius: 12px; width: 90%; max-width: 400px; border: 1px solid var(--border);">
      <h3 style="margin-bottom: 1rem; color: var(--accent);">GitHub Sync</h3>
      <div style="margin-bottom: 0.75rem;">
        <label style="display: block; margin-bottom: 0.25rem; font-size: 0.8rem; color: var(--muted);">Username</label>
        <input type="text" id="gh-username" placeholder="Bryan-Nsoh" style="width: 100%; padding: 0.6rem; border: 1px solid var(--border); border-radius: 6px; background: var(--bg); color: var(--text);">
      </div>
      <div style="margin-bottom: 0.75rem;">
        <label style="display: block; margin-bottom: 0.25rem; font-size: 0.8rem; color: var(--muted);">Repository</label>
        <input type="text" id="gh-repo" placeholder="bryan-phd" style="width: 100%; padding: 0.6rem; border: 1px solid var(--border); border-radius: 6px; background: var(--bg); color: var(--text);">
      </div>
      <div style="margin-bottom: 0.75rem;">
        <label style="display: block; margin-bottom: 0.25rem; font-size: 0.8rem; color: var(--muted);">Token</label>
        <input type="password" id="gh-token" placeholder="ghp_xxxx" style="width: 100%; padding: 0.6rem; border: 1px solid var(--border); border-radius: 6px; background: var(--bg); color: var(--text);">
        <small style="color: var(--muted); font-size: 0.7rem;"><a href="https://github.com/settings/tokens/new?scopes=repo" target="_blank" style="color: var(--accent);">Create token</a></small>
      </div>
      <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
        <button onclick="closeModal('github')" style="flex: 1; padding: 0.6rem; border: none; border-radius: 6px; background: var(--border); color: var(--text); cursor: pointer;">Cancel</button>
        <button onclick="disconnectGitHub()" id="gh-disconnect" style="display:none; flex: 1; padding: 0.6rem; border: none; border-radius: 6px; background: var(--red); color: white; cursor: pointer;">Disconnect</button>
        <button onclick="connectGitHub()" style="flex: 1; padding: 0.6rem; border: none; border-radius: 6px; background: var(--accent); color: var(--bg); cursor: pointer; font-weight: 600;">Connect</button>
      </div>
    </div>
  </div>

  <script>
    const defaultData = {
      settings: {
        startDate: "2025-08-01",
        endDate: "2029-05-15",
        creditsRequired: 36
      },
      courseCategories: [
        { id: "core", name: "Core Requirements", requiredCredits: 21 },
        { id: "domain", name: "ML/Domain", requiredCredits: 9 },
        { id: "breadth", name: "Knowledge Breadth", requiredCredits: 6 },
        { id: "600level", name: "600-Level Requirement", requiredCredits: 6 },
        { id: "seminar", name: "Seminar", requiredCredits: 3 }
      ],
      courses: [
        { name: "DSE 511: Data Sci & Computing I", category: "core", credits: 3, status: "in-progress", semester: "Fall 2025" },
        { name: "DSE 512: Data Sci & Computing II", category: "core", credits: 3, status: "planned", semester: "" },
        { name: "Data Analysis (CSCE 878)", category: "core", credits: 3, status: "transfer", semester: "Transfer" },
        { name: "Statistics I (STAT 563)", category: "core", credits: 3, status: "in-progress", semester: "Fall 2025" },
        { name: "Statistics II", category: "core", credits: 3, status: "planned", semester: "" },
        { name: "Math/Numerical (STAT 801A)", category: "core", credits: 3, status: "transfer", semester: "Transfer" },
        { name: "Adv Topics Data Mining (600-level)", category: "core", credits: 3, status: "planned", semester: "" },
        { name: "COSC 524: NLP", category: "domain", credits: 3, status: "in-progress", semester: "Fall 2025" },
        { name: "Domain Course 1", category: "domain", credits: 3, status: "planned", semester: "" },
        { name: "Domain Course 2", category: "domain", credits: 3, status: "planned", semester: "" },
        { name: "Ethics/Leadership/Communication 1", category: "breadth", credits: 3, status: "planned", semester: "" },
        { name: "Ethics/Leadership/Communication 2", category: "breadth", credits: 3, status: "planned", semester: "" },
        { name: "Additional 600-level", category: "600level", credits: 3, status: "planned", semester: "" },
        { name: "DSE 599 (Fall 2025)", category: "seminar", credits: 1, status: "in-progress", semester: "Fall 2025" },
        { name: "DSE 599 (Spring 2026)", category: "seminar", credits: 1, status: "planned", semester: "Spring 2026" },
        { name: "DSE 599 (Fall 2026)", category: "seminar", credits: 1, status: "planned", semester: "Fall 2026" }
      ],
      deadlines: [
        { name: "Fall 2025 Classes End", date: "2025-12-05" },
        { name: "Spring 2026 Registration", date: "2026-01-10" },
        { name: "Qualifying Exam", date: "2026-09-15" },
        { name: "Annual Review", date: "2026-04-01" },
        { name: "Proposal Defense", date: "2027-03-01" },
        { name: "Final Defense", date: "2029-04-15" }
      ],
      milestones: [
        { name: "First Semester Complete", completed: false },
        { name: "Committee Formed", completed: false },
        { name: "Qualifying Exam Passed", completed: false },
        { name: "Proposal Defended", completed: false },
        { name: "Dissertation Research", completed: false },
        { name: "Final Defense", completed: false }
      ],
      // Events with optional time, category, and recurring
      // category: deadline, academic, meeting, personal, work
      // recurring: null, "weekly", "biweekly", "monthly"
      events: [
        { name: "Lab Meeting", date: "2025-12-13", time: "14:00", category: "meeting", recurring: "weekly" },
        { name: "Advisor 1:1", date: "2025-12-12", time: "10:00", category: "meeting", recurring: "biweekly" }
      ]
    };

    let ghConfig = JSON.parse(localStorage.getItem('bryan-phd-gh')) || null;
    let fileSha = null;
    let data = JSON.parse(localStorage.getItem('bryan-phd-data')) || defaultData;

    // Ensure events array exists
    if (!data.events) data.events = [];

    let currentMonth = new Date().getMonth();
    let currentYear = new Date().getFullYear();
    let calendarView = 'year'; // 'year' or 'month'
    let selectedMonthDetail = null;

    function showTab(tabId) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
      document.querySelector(`[onclick="showTab('${tabId}')"]`).classList.add('active');
      document.getElementById('tab-' + tabId).classList.add('active');
    }

    function toggleCategory(id) {
      document.getElementById('cat-' + id).classList.toggle('collapsed');
    }

    function render() {
      renderHeader();
      renderCourseCategories();
      renderOverview();
      renderDeadlines();
      renderMilestones();
      renderCalendar();
    }

    function renderHeader() {
      const s = data.settings;
      const start = new Date(s.startDate);
      const end = new Date(s.endDate);
      const today = new Date();
      const pct = Math.min(100, Math.max(0, ((today - start) / (end - start)) * 100));

      document.getElementById('timeline-bar').style.width = pct + '%';
      document.getElementById('timeline-text').textContent = pct.toFixed(0) + '% complete';

      const completed = data.courses.filter(c => c.status === 'completed').reduce((s, c) => s + c.credits, 0);
      const transferred = data.courses.filter(c => c.status === 'transfer').reduce((s, c) => s + c.credits, 0);
      const inProgress = data.courses.filter(c => c.status === 'in-progress').reduce((s, c) => s + c.credits, 0);
      const total = completed + transferred;
      const remaining = Math.max(0, s.creditsRequired - total - inProgress);

      document.getElementById('credits-stat').textContent = `${total}/${s.creditsRequired}`;
      document.getElementById('transferred-stat').textContent = transferred;
      document.getElementById('in-progress-stat').textContent = inProgress;
      document.getElementById('remaining-stat').textContent = remaining;
      document.getElementById('sum-transferred').textContent = transferred;
      document.getElementById('sum-completed').textContent = completed;
      document.getElementById('sum-inprogress').textContent = inProgress;
      document.getElementById('sum-remaining').textContent = remaining;

      const upcoming = data.deadlines
        .map(d => ({ ...d, days: Math.ceil((new Date(d.date) - today) / 86400000) }))
        .filter(d => d.days >= 0)
        .sort((a, b) => a.days - b.days);
      document.getElementById('next-deadline-stat').textContent = upcoming.length ? upcoming[0].days : '--';
    }

    function renderCourseCategories() {
      const container = document.getElementById('course-categories');
      container.innerHTML = data.courseCategories.map(cat => {
        const courses = data.courses.filter(c => c.category === cat.id);
        const completed = courses.filter(c => c.status === 'completed' || c.status === 'transfer').reduce((s, c) => s + c.credits, 0);
        const inProg = courses.filter(c => c.status === 'in-progress').reduce((s, c) => s + c.credits, 0);

        return `
          <div class="category" id="cat-${cat.id}">
            <div class="category-header" onclick="toggleCategory('${cat.id}')">
              <span class="category-title"><span class="arrow">▼</span> ${cat.name}</span>
              <span class="category-credits">${completed}${inProg ? '+' + inProg : ''}/${cat.requiredCredits} cr</span>
            </div>
            <div class="category-courses">
              ${courses.map(c => {
                const isCompleted = c.status === 'completed' || c.status === 'transfer';
                return `
                  <div class="course-row ${isCompleted ? 'completed' : ''}">
                    <span class="course-title">${c.name}</span>
                    <div class="course-meta">
                      ${c.status === 'in-progress' ? '<span class="badge in-progress">IN PROGRESS</span>' : ''}
                      ${c.status === 'transfer' ? '<span class="badge transfer">TRANSFER</span>' : ''}
                      ${c.status === 'planned' && c.semester ? `<span class="badge planned">${c.semester}</span>` : ''}
                      <span class="credits">${c.credits}cr</span>
                    </div>
                  </div>
                `;
              }).join('')}
            </div>
          </div>
        `;
      }).join('');
    }

    function renderOverview() {
      const current = data.courses.filter(c => c.status === 'in-progress');
      document.getElementById('current-courses').innerHTML = current.length
        ? current.map(c => `<div class="course-row"><span class="course-title">${c.name}</span><span class="credits">${c.credits}cr</span></div>`).join('')
        : '<div style="color: var(--muted); padding: 1rem; text-align: center;">No courses in progress</div>';

      const today = new Date();
      const upcoming = data.deadlines
        .map(d => ({ ...d, days: Math.ceil((new Date(d.date) - today) / 86400000) }))
        .filter(d => d.days >= 0)
        .sort((a, b) => a.days - b.days)
        .slice(0, 4);

      document.getElementById('upcoming-deadlines').innerHTML = upcoming.length
        ? upcoming.map(d => renderDeadlineItem(d)).join('')
        : '<div style="color: var(--muted); padding: 1rem; text-align: center;">No upcoming deadlines</div>';

      document.getElementById('overview-milestones').innerHTML = data.milestones.map((m, i) => `
        <div class="milestone-item">
          <div class="milestone-check ${m.completed ? 'done' : ''}">${m.completed ? '✓' : ''}</div>
          <span>${m.name}</span>
        </div>
      `).join('');
    }

    function renderDeadlineItem(d) {
      const urgency = d.days <= 14 ? 'red' : d.days <= 30 ? 'yellow' : 'green';
      let remaining = d.days + 'd';
      if (d.days > 365) remaining = (d.days / 365).toFixed(1) + 'yr';
      else if (d.days > 60) remaining = (d.days / 30).toFixed(1) + 'mo';
      const dateStr = new Date(d.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });

      return `
        <div class="deadline-item">
          <div class="urgency ${urgency}"></div>
          <div class="deadline-info">
            <div class="deadline-name">${d.name}</div>
            <div class="deadline-date">${dateStr}</div>
          </div>
          <div class="deadline-remaining">${remaining}</div>
        </div>
      `;
    }

    function renderDeadlines() {
      const today = new Date();
      const sorted = data.deadlines
        .map(d => ({ ...d, days: Math.ceil((new Date(d.date) - today) / 86400000) }))
        .sort((a, b) => a.days - b.days);

      document.getElementById('all-deadlines').innerHTML = sorted.length
        ? sorted.map(d => renderDeadlineItem(d)).join('')
        : '<div style="color: var(--muted); padding: 1rem; text-align: center;">No deadlines</div>';
    }

    function renderMilestones() {
      document.getElementById('all-milestones').innerHTML = data.milestones.map(m => `
        <div class="milestone-item">
          <div class="milestone-check ${m.completed ? 'done' : ''}">${m.completed ? '✓' : ''}</div>
          <span>${m.name}</span>
        </div>
      `).join('');
    }

    // Calendar view toggle
    function setCalendarView(view) {
      calendarView = view;
      document.getElementById('view-year').classList.toggle('active', view === 'year');
      document.getElementById('view-month').classList.toggle('active', view === 'month');
      document.getElementById('year-view').style.display = view === 'year' ? 'block' : 'none';
      document.getElementById('month-view').style.display = view === 'month' ? 'block' : 'none';
      renderCalendar();
    }

    function changeCalendarPeriod(delta) {
      if (calendarView === 'year') {
        currentYear += delta;
      } else {
        currentMonth += delta;
        if (currentMonth > 11) { currentMonth = 0; currentYear++; }
        if (currentMonth < 0) { currentMonth = 11; currentYear--; }
      }
      renderCalendar();
    }

    // Get all events for a month (including recurring)
    function getAllEventsForMonth(year, month) {
      const events = [];
      const daysInMonth = new Date(year, month + 1, 0).getDate();

      for (let day = 1; day <= daysInMonth; day++) {
        const dateStr = formatDateStr(year, month, day);
        const dayEvents = getEventsForDate(dateStr);
        dayEvents.forEach(e => {
          events.push({ ...e, date: dateStr, day });
        });
      }

      return events.sort((a, b) => a.day - b.day || (a.time || '99:99').localeCompare(b.time || '99:99'));
    }

    // Render year view
    function renderYearView() {
      const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
      const today = new Date();
      const currentMonthIndex = today.getMonth();
      const currentYearIndex = today.getFullYear();

      document.getElementById('calendar-title').textContent = currentYear;

      let html = '';
      for (let m = 0; m < 12; m++) {
        const events = getAllEventsForMonth(currentYear, m);
        const deadlineCount = events.filter(e => e.category === 'deadline' || e.category === 'milestone').length;
        const otherCount = events.length - deadlineCount;
        const isCurrent = (m === currentMonthIndex && currentYear === currentYearIndex);
        const isSelected = (selectedMonthDetail === m);

        html += `
          <div class="month-card ${isCurrent ? 'current' : ''} ${isSelected ? 'selected' : ''}" onclick="showMonthDetail(${m})">
            <div class="month-card-name">${monthNames[m]}</div>
            <div class="month-card-count">
              ${deadlineCount > 0 ? `<span class="deadlines">${deadlineCount} deadline${deadlineCount > 1 ? 's' : ''}</span>` : ''}
              ${otherCount > 0 ? `<span class="events">${otherCount} event${otherCount > 1 ? 's' : ''}</span>` : ''}
              ${events.length === 0 ? '<span>No events</span>' : ''}
            </div>
          </div>
        `;
      }

      document.getElementById('year-grid').innerHTML = html;

      // Render month detail if selected
      if (selectedMonthDetail !== null) {
        renderMonthDetail(selectedMonthDetail);
      }
    }

    function showMonthDetail(month) {
      if (selectedMonthDetail === month) {
        selectedMonthDetail = null;
        document.getElementById('month-detail-container').innerHTML = '';
        document.querySelectorAll('.month-card').forEach(c => c.classList.remove('selected'));
      } else {
        selectedMonthDetail = month;
        renderYearView();
      }
    }

    function renderMonthDetail(month) {
      const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
      const events = getAllEventsForMonth(currentYear, month);

      if (events.length === 0) {
        document.getElementById('month-detail-container').innerHTML = `
          <div class="month-detail">
            <div class="month-detail-header">
              <h3>${monthNames[month]} ${currentYear}</h3>
              <button class="month-detail-close" onclick="showMonthDetail(${month})">×</button>
            </div>
            <div style="color: var(--muted); padding: 1rem; text-align: center;">No events this month</div>
          </div>
        `;
        return;
      }

      const eventsHtml = events.map(e => {
        const dateObj = new Date(e.date + 'T12:00:00');
        const dayStr = dateObj.getDate();
        const dayName = dateObj.toLocaleDateString('en-US', { weekday: 'short' });

        return `
          <div class="month-event-item ${e.category}">
            <div class="month-event-date">${dayName}<br>${dayStr}</div>
            <div class="month-event-info">
              <div class="month-event-name">
                ${e.name}
                ${e.recurring ? '<span class="month-event-badge">recurring</span>' : ''}
              </div>
              ${e.time ? `<div class="month-event-time">${formatTime(e.time)}</div>` : ''}
            </div>
          </div>
        `;
      }).join('');

      document.getElementById('month-detail-container').innerHTML = `
        <div class="month-detail">
          <div class="month-detail-header">
            <h3>${monthNames[month]} ${currentYear} — ${events.length} event${events.length > 1 ? 's' : ''}</h3>
            <button class="month-detail-close" onclick="showMonthDetail(${month})">×</button>
          </div>
          <div class="month-event-list">${eventsHtml}</div>
        </div>
      `;
    }

    // Calendar with recurring event support
    function getEventsForDate(dateStr) {
      const events = [];
      const targetDate = new Date(dateStr + 'T12:00:00');

      // Add deadlines
      data.deadlines.forEach(d => {
        if (d.date === dateStr) {
          events.push({ name: d.name, category: 'deadline', time: null });
        }
      });

      // Add events (with recurring logic)
      data.events.forEach(e => {
        if (e.date === dateStr) {
          events.push({ name: e.name, category: e.category || 'meeting', time: e.time });
        } else if (e.recurring) {
          const eventDate = new Date(e.date + 'T12:00:00');
          if (targetDate >= eventDate) {
            const daysDiff = Math.floor((targetDate - eventDate) / 86400000);
            let matches = false;

            if (e.recurring === 'weekly' && daysDiff % 7 === 0) matches = true;
            if (e.recurring === 'biweekly' && daysDiff % 14 === 0) matches = true;
            if (e.recurring === 'monthly' && targetDate.getDate() === eventDate.getDate()) matches = true;

            if (matches) {
              events.push({ name: e.name, category: e.category || 'meeting', time: e.time, recurring: true });
            }
          }
        }
      });

      return events.sort((a, b) => {
        if (!a.time && !b.time) return 0;
        if (!a.time) return 1;
        if (!b.time) return -1;
        return a.time.localeCompare(b.time);
      });
    }

    function formatTime(time) {
      if (!time) return '';
      const [h, m] = time.split(':');
      const hour = parseInt(h);
      const ampm = hour >= 12 ? 'pm' : 'am';
      const hour12 = hour % 12 || 12;
      return `${hour12}${m !== '00' ? ':' + m : ''}${ampm}`;
    }

    function renderCalendar() {
      if (calendarView === 'year') {
        renderYearView();
        renderAgenda();
        return;
      }

      const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
      document.getElementById('calendar-title').textContent = `${monthNames[currentMonth]} ${currentYear}`;

      const firstDay = new Date(currentYear, currentMonth, 1).getDay();
      const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
      const daysInPrevMonth = new Date(currentYear, currentMonth, 0).getDate();
      const today = new Date().toISOString().split('T')[0];

      let html = '';

      // Previous month
      for (let i = firstDay - 1; i >= 0; i--) {
        const day = daysInPrevMonth - i;
        const dateStr = formatDateStr(currentYear, currentMonth - 1, day);
        html += renderCalendarDay(day, dateStr, true, today);
      }

      // Current month
      for (let day = 1; day <= daysInMonth; day++) {
        const dateStr = formatDateStr(currentYear, currentMonth, day);
        html += renderCalendarDay(day, dateStr, false, today);
      }

      // Next month
      const totalCells = Math.ceil((firstDay + daysInMonth) / 7) * 7;
      const remaining = totalCells - (firstDay + daysInMonth);
      for (let day = 1; day <= remaining; day++) {
        const dateStr = formatDateStr(currentYear, currentMonth + 1, day);
        html += renderCalendarDay(day, dateStr, true, today);
      }

      document.getElementById('calendar-days').innerHTML = html;
      renderAgenda();
    }

    function formatDateStr(year, month, day) {
      const d = new Date(year, month, day);
      return d.toISOString().split('T')[0];
    }

    function renderCalendarDay(day, dateStr, isOtherMonth, today) {
      const isToday = dateStr === today;
      const events = getEventsForDate(dateStr);
      const hasEvents = events.length > 0;

      let classes = 'calendar-day';
      if (isOtherMonth) classes += ' other-month';
      if (isToday) classes += ' today';
      if (hasEvents) classes += ' has-events';

      let eventsHtml = '';
      const maxShow = 3;
      events.slice(0, maxShow).forEach(e => {
        const recurClass = e.recurring ? ' recurring' : '';
        const timeStr = e.time ? formatTime(e.time) + ' ' : '';
        eventsHtml += `<div class="cal-event ${e.category}${recurClass}">${timeStr}${e.name}</div>`;
      });
      if (events.length > maxShow) {
        eventsHtml += `<div class="more-events">+${events.length - maxShow} more</div>`;
      }

      return `
        <div class="${classes}">
          <span class="day-number">${day}</span>
          <div class="day-events">${eventsHtml}</div>
        </div>
      `;
    }

    function renderAgenda() {
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      const days = [];

      for (let i = 0; i < 14; i++) {
        const date = new Date(today);
        date.setDate(date.getDate() + i);
        const dateStr = date.toISOString().split('T')[0];
        const events = getEventsForDate(dateStr);
        if (events.length > 0) {
          days.push({ date, dateStr, events, isToday: i === 0 });
        }
      }

      if (days.length === 0) {
        document.getElementById('agenda-list').innerHTML = '<div style="color: var(--muted); padding: 1rem; text-align: center;">No events in the next 14 days</div>';
        return;
      }

      document.getElementById('agenda-list').innerHTML = days.map(d => {
        const dayLabel = d.date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
        return `
          <div class="agenda-day">
            <div class="agenda-date ${d.isToday ? 'today' : ''}">${d.isToday ? 'Today - ' : ''}${dayLabel}</div>
            ${d.events.map(e => `
              <div class="agenda-event ${e.category}">
                <span class="agenda-time">${e.time ? formatTime(e.time) : 'All day'}</span>
                <span class="agenda-title">${e.name}</span>
                ${e.recurring ? '<span class="agenda-badge">recurring</span>' : ''}
              </div>
            `).join('')}
          </div>
        `;
      }).join('');
    }


    // Save & Sync
    async function save() {
      localStorage.setItem('bryan-phd-data', JSON.stringify(data));
      render();
      if (ghConfig) await syncToGitHub();
    }

    function updateSyncStatus(status, text) {
      document.getElementById('sync-dot').className = 'sync-dot ' + status;
      document.getElementById('sync-text').textContent = text;
    }

    async function syncToGitHub() {
      if (!ghConfig) return;
      updateSyncStatus('syncing', 'Syncing...');
      try {
        const { username, repo, token } = ghConfig;
        const apiUrl = `https://api.github.com/repos/${username}/${repo}/contents/data.json`;
        const getRes = await fetch(apiUrl, { headers: { 'Authorization': `token ${token}` } });
        if (getRes.ok) fileSha = (await getRes.json()).sha;
        const content = btoa(unescape(encodeURIComponent(JSON.stringify(data, null, 2))));
        const body = { message: `Update - ${new Date().toLocaleString()}`, content, branch: 'main' };
        if (fileSha) body.sha = fileSha;
        const putRes = await fetch(apiUrl, {
          method: 'PUT',
          headers: { 'Authorization': `token ${token}`, 'Content-Type': 'application/json' },
          body: JSON.stringify(body)
        });
        if (putRes.ok) {
          fileSha = (await putRes.json()).content.sha;
          updateSyncStatus('connected', 'Synced');
        } else throw new Error();
      } catch (e) {
        updateSyncStatus('error', 'Sync failed');
      }
    }

    async function loadFromGitHub() {
      if (!ghConfig) return false;
      try {
        const { username, repo, token } = ghConfig;
        const res = await fetch(`https://api.github.com/repos/${username}/${repo}/contents/data.json`, {
          headers: { 'Authorization': `token ${token}` }
        });
        if (res.ok) {
          const fileData = await res.json();
          fileSha = fileData.sha;
          data = JSON.parse(decodeURIComponent(escape(atob(fileData.content))));
          if (!data.events) data.events = [];
          localStorage.setItem('bryan-phd-data', JSON.stringify(data));
          return true;
        }
      } catch (e) {}
      return false;
    }

    function openModal(type) {
      document.getElementById('modal-' + type).style.display = 'flex';
      if (type === 'github' && ghConfig) {
        document.getElementById('gh-username').value = ghConfig.username;
        document.getElementById('gh-repo').value = ghConfig.repo;
        document.getElementById('gh-token').value = ghConfig.token;
        document.getElementById('gh-disconnect').style.display = 'block';
      }
    }

    function closeModal(type) {
      document.getElementById('modal-' + type).style.display = 'none';
    }

    async function connectGitHub() {
      const username = document.getElementById('gh-username').value.trim();
      const repo = document.getElementById('gh-repo').value.trim();
      const token = document.getElementById('gh-token').value.trim();
      if (!username || !repo || !token) return alert('Fill all fields');
      updateSyncStatus('syncing', 'Connecting...');
      try {
        const res = await fetch(`https://api.github.com/repos/${username}/${repo}`, {
          headers: { 'Authorization': `token ${token}` }
        });
        if (!res.ok) throw new Error();
        ghConfig = { username, repo, token };
        localStorage.setItem('bryan-phd-gh', JSON.stringify(ghConfig));
        if (await loadFromGitHub()) render();
        else await syncToGitHub();
        closeModal('github');
        updateSyncStatus('connected', 'Connected');
      } catch (e) {
        alert('Failed to connect');
        updateSyncStatus('error', 'Failed');
      }
    }

    function disconnectGitHub() {
      ghConfig = null;
      fileSha = null;
      localStorage.removeItem('bryan-phd-gh');
      updateSyncStatus('', 'Local only');
      closeModal('github');
    }

    function exportData() {
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'phd-tracker.json';
      a.click();
    }

    function importData(event) {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = e => {
        try {
          data = JSON.parse(e.target.result);
          if (!data.events) data.events = [];
          save();
        } catch (err) {
          alert('Invalid JSON');
        }
      };
      reader.readAsText(file);
    }

    document.getElementById('modal-github').addEventListener('click', e => {
      if (e.target.id === 'modal-github') closeModal('github');
    });

    async function init() {
      if (ghConfig) {
        updateSyncStatus('syncing', 'Loading...');
        if (await loadFromGitHub()) updateSyncStatus('connected', 'Connected');
        else updateSyncStatus('connected', 'Connected');
      }
      render();
    }

    init();
  </script>
</body>
</html>
